#!/usr/bin/env bash
# https://github.com/bitterhalt
set -euo pipefail

CONFIRM="fuzzel -d -a top-right --x 4 --y 4 -w 10 -l2 -p Sure? "

if [[ ${XDG_CURRENT_DESKTOP:-} == *Hyprland* ]]; then
  LOGOUT_CMD="hyprctl dispatch exit 0"
elif [[ ${XDG_CURRENT_DESKTOP:-} == *sway* || ${XDG_SESSION_DESKTOP:-} == *sway* ]]; then
  LOGOUT_CMD="swaymsg exit"
else
  LOGOUT_CMD="loginctl terminate-user $USER"
fi

confirm_action() {
  [[ "$(echo -e "Yes\nNo" | $CONFIRM)" == "Yes" ]]
}

case "$(printf "%s\n" "Lock" "Logout" "Suspend" "Reboot" "Shutdown" | fuzzel -d -a top-right --x 4 --y 4 -l5 -w 10 -p "" --placeholder "Select:")" in
"Shutdown")
  if confirm_action; then
    systemctl poweroff
  fi
  ;;
"Reboot")
  if confirm_action; then
    systemctl reboot
  fi
  ;;
"Suspend")
  systemctl suspend
  ;;
"Lock")
  swaylock -f
  ;;
"Logout")
  eval "$LOGOUT_CMD"
  ;;
esac
