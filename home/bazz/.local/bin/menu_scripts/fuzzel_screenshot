#!/usr/bin/env bash

set -e

get_options() {
  echo "Record Screen"
  echo "Record Screen (Audio)"
  echo "Record Region"
  echo "Screenshot Full"
  echo "Screenshot Region"
  echo "Screenshot Full (Delay)"
  echo "Stop Recording"
}

# Ping waybar
sig() {
  if pgrep -x waybar >/dev/null 2>&1; then
    pkill -SIGRTMIN+2 waybar
  fi
}

main() {
  choice=$( (get_options) | fuzzel -d -a top --y 4 -w 22 -l 7 --hide-prompt)

  if [[ -z "${choice// /}" ]]; then
    exit 1
  fi

  case $choice in
  'Record Screen')
    wl-record -f && sig
    ;;
  'Record Screen (Audio)')
    wl-record -fs && sig
    ;;
  'Record Region')
    wl-record -r && sig
    ;;
  'Screenshot Full')
    wl-shot -f
    ;;
  'Screenshot Region')
    wl-shot -r
    ;;
  'Screenshot Full (Delay)')
    wl-shot -t
    ;;
  'Stop Recording')
    wl-record -k && sig
    ;;
  esac
}

main &
exit 0
