#!/usr/bin/env bash
set -e

node=$(pw-dump Node | jq -r '
  .[]
  | select(.info.props["media.class"] == "Audio/Sink")
  | .info.props["node.description"]
' | fuzzel -d -a top --y 4 -w 55 -l 6 -p "" --placeholder "Switch audio device: ")

[ -z "$node" ] && exit 0

id=$(pw-dump Node | jq --arg desc "$node" -r '
  .[]
  | select(
      .info.props["media.class"] == "Audio/Sink"
      and .info.props["node.description"] == $desc
    )
  | .id
')

[ -z "$id" ] && exit 0

wpctl set-default "$id"
notify-send -t 5000 -i audio-speakers "Audio notify" "Audio device changed to:\n$node"
